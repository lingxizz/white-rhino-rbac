import{d as Z,n as ee,r as s,o as P,c as A,e as t,w as l,f as u,j as te,s as ae,C as oe,b as D,t as O,F as le,q as ne,g as d,h as se,l as ie,z as V,M as h}from"./index-CGZB2ZEZ.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"permission-management"},re={class:"path-text"},me=Z({__name:"PermissionManagement",setup(pe){const g=d(!1),E=d([]),U=d([]),r=d(!1),c=d(!1),y=d(""),f=d(void 0),C=d(),a=se({name:"",code:"",type:"menu",path:"",component:"",icon:"",sortOrder:0,status:!0,description:""}),S={name:[{required:!0,message:"Please enter permission name"}]},z=ie(()=>E.value),F=n=>{switch(n){case"menu":return"icon-menu";case"api":return"icon-api";case"button":return"icon-desktop";default:return"icon-lock"}},I=n=>{switch(n){case"menu":return"arcoblue";case"api":return"green";case"button":return"orange";default:return"gray"}},x=async()=>{g.value=!0;try{const n=await V.getPermissions();E.value=n,U.value=n.map(e=>e.id)}finally{g.value=!1}},M=()=>{a.name="",a.code="",a.type="menu",a.path="",a.component="",a.icon="",a.sortOrder=0,a.status=!0,a.description="",f.value=void 0},N=()=>{c.value=!1,y.value="",M(),r.value=!0},B=n=>{c.value=!1,y.value="",M(),f.value=n.id,r.value=!0},R=n=>{var e;c.value=!0,y.value=n.id,f.value=(e=n.parent)==null?void 0:e.id,a.name=n.name,a.code=n.code||"",a.type=n.type,a.path=n.path||"",a.component=n.component||"",a.icon=n.icon||"",a.sortOrder=n.sortOrder,a.status=n.status,a.description=n.description||"",r.value=!0},T=async()=>{var e;if(!await((e=C.value)==null?void 0:e.validate()))try{const m={...a};f.value&&(m.parentId=f.value),c.value?(await V.updatePermission(y.value,m),h.success("Permission updated successfully")):(await V.createPermission(m),h.success("Permission created successfully")),r.value=!1,x()}catch(m){console.error("Failed to save permission:",m)}},$=()=>{var n;r.value=!1,(n=C.value)==null||n.resetFields()},q=async n=>{try{await V.deletePermission(n.id),h.success("Permission deleted successfully"),x()}catch(e){console.error("Failed to delete permission:",e)}};return ee(()=>{x()}),(n,e)=>{const m=s("icon-plus"),b=s("a-button"),k=s("a-space"),p=s("a-table-column"),K=s("a-tag"),j=s("a-badge"),G=s("a-popconfirm"),H=s("a-table"),_=s("a-input"),i=s("a-form-item"),w=s("a-option"),J=s("a-select"),L=s("a-input-number"),Q=s("a-switch"),W=s("a-textarea"),X=s("a-form"),Y=s("a-modal");return P(),A("div",de,[t(k,{class:"header-actions",size:"medium"},{default:l(()=>[t(b,{type:"primary",onClick:N},{icon:l(()=>[t(m)]),default:l(()=>[e[10]||(e[10]=u(" Add Permission ",-1))]),_:1})]),_:1}),t(H,{data:z.value,loading:g.value,pagination:!1,expandable:{expandedRowKeys:U.value},"row-key":"id"},{columns:l(()=>[t(p,{title:"Name","data-index":"name"},{cell:l(({record:o})=>[t(k,null,{default:l(()=>[(P(),te(ae(F(o.type)),{style:oe({color:I(o.type)})},null,8,["style"])),D("span",null,O(o.name),1)]),_:2},1024)]),_:1}),t(p,{title:"Code","data-index":"code"}),t(p,{title:"Type"},{cell:l(({record:o})=>[t(K,{color:I(o.type)},{default:l(()=>{var v;return[u(O((v=o.type)==null?void 0:v.toUpperCase()),1)]}),_:2},1032,["color"])]),_:1}),t(p,{title:"Path","data-index":"path"},{cell:l(({record:o})=>[D("span",re,O(o.path||"-"),1)]),_:1}),t(p,{title:"Sort","data-index":"sortOrder",width:"80"}),t(p,{title:"Status",width:"100"},{cell:l(({record:o})=>[t(j,{status:o.status?"success":"danger",text:o.status?"Active":"Inactive"},null,8,["status","text"])]),_:1}),t(p,{title:"Actions",width:"180"},{cell:l(({record:o})=>[t(k,null,{default:l(()=>[t(b,{type:"text",size:"small",onClick:v=>B(o)},{default:l(()=>[...e[11]||(e[11]=[u("Add Child",-1)])]),_:1},8,["onClick"]),t(b,{type:"text",size:"small",onClick:v=>R(o)},{default:l(()=>[...e[12]||(e[12]=[u("Edit",-1)])]),_:1},8,["onClick"]),t(G,{content:"Are you sure to delete this permission?",onOk:v=>q(o)},{default:l(()=>[t(b,{type:"text",status:"danger",size:"small"},{default:l(()=>[...e[13]||(e[13]=[u("Delete",-1)])]),_:1})]),_:1},8,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading","expandable"]),t(Y,{visible:r.value,"onUpdate:visible":e[9]||(e[9]=o=>r.value=o),title:c.value?"Edit Permission":"Create Permission",onOk:T,onCancel:$},{default:l(()=>[t(X,{ref_key:"formRef",ref:C,model:a,rules:S,layout:"vertical"},{default:l(()=>[t(i,{field:"name",label:"Name"},{default:l(()=>[t(_,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.name=o),placeholder:"Enter permission name"},null,8,["modelValue"])]),_:1}),t(i,{field:"code",label:"Code"},{default:l(()=>[t(_,{modelValue:a.code,"onUpdate:modelValue":e[1]||(e[1]=o=>a.code=o),placeholder:"Enter permission code"},null,8,["modelValue"])]),_:1}),t(i,{field:"type",label:"Type"},{default:l(()=>[t(J,{modelValue:a.type,"onUpdate:modelValue":e[2]||(e[2]=o=>a.type=o),placeholder:"Select type"},{default:l(()=>[t(w,{value:"menu"},{default:l(()=>[...e[14]||(e[14]=[u("Menu",-1)])]),_:1}),t(w,{value:"api"},{default:l(()=>[...e[15]||(e[15]=[u("API",-1)])]),_:1}),t(w,{value:"button"},{default:l(()=>[...e[16]||(e[16]=[u("Button",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.type==="menu"?(P(),A(le,{key:0},[t(i,{field:"path",label:"Path"},{default:l(()=>[t(_,{modelValue:a.path,"onUpdate:modelValue":e[3]||(e[3]=o=>a.path=o),placeholder:"Enter route path (e.g., /system/users)"},null,8,["modelValue"])]),_:1}),t(i,{field:"component",label:"Component"},{default:l(()=>[t(_,{modelValue:a.component,"onUpdate:modelValue":e[4]||(e[4]=o=>a.component=o),placeholder:"Enter component path"},null,8,["modelValue"])]),_:1}),t(i,{field:"icon",label:"Icon"},{default:l(()=>[t(_,{modelValue:a.icon,"onUpdate:modelValue":e[5]||(e[5]=o=>a.icon=o),placeholder:"Enter icon name"},null,8,["modelValue"])]),_:1})],64)):ne("",!0),t(i,{field:"sortOrder",label:"Sort Order"},{default:l(()=>[t(L,{modelValue:a.sortOrder,"onUpdate:modelValue":e[6]||(e[6]=o=>a.sortOrder=o),min:0},null,8,["modelValue"])]),_:1}),t(i,{field:"status",label:"Status"},{default:l(()=>[t(Q,{modelValue:a.status,"onUpdate:modelValue":e[7]||(e[7]=o=>a.status=o)},null,8,["modelValue"])]),_:1}),t(i,{field:"description",label:"Description"},{default:l(()=>[t(W,{modelValue:a.description,"onUpdate:modelValue":e[8]||(e[8]=o=>a.description=o),placeholder:"Enter description"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),_e=ue(me,[["__scopeId","data-v-2bd9bea5"]]);export{_e as default};
