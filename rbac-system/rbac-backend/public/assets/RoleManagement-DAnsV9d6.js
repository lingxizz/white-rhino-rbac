import{d as ie,n as re,r as n,o as f,c as B,e as s,w as o,f as c,F as ce,k as de,j as P,b as u,t as d,s as ue,q as me,g as r,h as pe,l as _e,y as v,z as fe,B as ve,M as R}from"./index-CGZB2ZEZ.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"role-management"},ke={class:"role-code"},be={class:"role-desc"},we={class:"role-stats"},Ve=ie({__name:"RoleManagement",setup(Re){const x=r(!1),M=r([]),A=r([]),m=r(!1),p=r(!1),y=r(!1),_=r(""),g=r([]),C=r(),l=pe({code:"",name:"",description:"",status:!0}),O={code:[{required:!0,message:"Please enter role code"}],name:[{required:!0,message:"Please enter role name"}]},z=_e(()=>A.value.map(t=>{var e;return{key:t.id,title:t.name,name:t.name,type:t.type,children:((e=t.children)==null?void 0:e.map(i=>({key:i.id,title:i.name,name:i.name,type:i.type})))||[]}})),I=t=>{switch(t){case"menu":return"icon-menu";case"api":return"icon-api";case"button":return"icon-button";default:return"icon-lock"}},k=async()=>{x.value=!0;try{const t=await v.getRoles();M.value=t}finally{x.value=!1}},S=async()=>{try{const t=await fe.getPermissions();A.value=t}catch(t){console.error("Failed to fetch permissions:",t)}},q=()=>{y.value=!1,_.value="",l.code="",l.name="",l.description="",l.status=!0,m.value=!0},T=(t,e)=>{switch(t){case"edit":$(e);break;case"permissions":j(e);break;case"delete":G(e);break}},$=t=>{y.value=!0,_.value=t.id,l.code=t.code,l.name=t.name,l.description=t.description||"",l.status=t.status,m.value=!0},j=t=>{var e;_.value=t.id,g.value=((e=t.permissions)==null?void 0:e.map(i=>i.id))||[],p.value=!0},K=async()=>{var e;if(!await((e=C.value)==null?void 0:e.validate()))try{y.value?(await v.updateRole(_.value,l),R.success("Role updated successfully")):(await v.createRole(l),R.success("Role created successfully")),m.value=!1,k()}catch(i){console.error("Failed to save role:",i)}},L=()=>{var t;m.value=!1,(t=C.value)==null||t.resetFields()},G=t=>{ve.confirm({title:"Confirm Delete",content:`Are you sure to delete role "${t.name}"?`,onOk:async()=>{try{await v.deleteRole(t.id),R.success("Role deleted successfully"),k()}catch(e){console.error("Failed to delete role:",e)}}})},H=async()=>{try{await v.assignPermissions(_.value,g.value),R.success("Permissions assigned successfully"),p.value=!1,k()}catch(t){console.error("Failed to assign permissions:",t)}};return re(()=>{k(),S()}),(t,e)=>{const i=n("icon-plus"),E=n("a-button"),b=n("a-space"),J=n("icon-safe"),U=n("a-tag"),Q=n("icon-more"),W=n("icon-edit"),h=n("a-doption"),D=n("icon-lock"),X=n("icon-delete"),Y=n("a-dropdown"),Z=n("icon-user"),ee=n("a-card"),te=n("a-col"),se=n("a-row"),F=n("a-input"),w=n("a-form-item"),oe=n("a-textarea"),ae=n("a-switch"),ne=n("a-form"),N=n("a-modal"),le=n("a-tree");return f(),B("div",ge,[s(b,{class:"header-actions",size:"medium"},{default:o(()=>[s(E,{type:"primary",onClick:q},{icon:o(()=>[s(i)]),default:o(()=>[e[8]||(e[8]=c(" Add Role ",-1))]),_:1})]),_:1}),s(se,{gutter:16},{default:o(()=>[(f(!0),B(ce,null,de(M.value,a=>(f(),P(te,{key:a.id,span:8,style:{"margin-bottom":"16px"}},{default:o(()=>[s(ee,{bordered:!1,class:"role-card"},{title:o(()=>[s(b,null,{default:o(()=>[s(J,{style:{color:"#165dff"}}),u("span",null,d(a.name),1),s(U,{color:a.status?"green":"red"},{default:o(()=>[c(d(a.status?"Active":"Inactive"),1)]),_:2},1032,["color"])]),_:2},1024)]),extra:o(()=>[s(Y,{onSelect:V=>T(V,a)},{content:o(()=>[s(h,{value:"edit"},{icon:o(()=>[s(W)]),default:o(()=>[e[9]||(e[9]=c(" Edit ",-1))]),_:1}),s(h,{value:"permissions"},{icon:o(()=>[s(D)]),default:o(()=>[e[10]||(e[10]=c(" Permissions ",-1))]),_:1}),s(h,{value:"delete",status:"danger"},{icon:o(()=>[s(X)]),default:o(()=>[e[11]||(e[11]=c(" Delete ",-1))]),_:1})]),default:o(()=>[s(E,{type:"text"},{default:o(()=>[s(Q)]),_:1})]),_:1},8,["onSelect"])]),default:o(()=>[u("p",ke,"Code: "+d(a.code),1),u("p",be,d(a.description||"No description"),1),u("div",we,[s(b,{size:"large"},{default:o(()=>{var V;return[u("span",null,[s(Z),c(" "+d(a.userCount||0)+" Users ",1)]),u("span",null,[s(D),c(" "+d(((V=a.permissions)==null?void 0:V.length)||0)+" Permissions ",1)])]}),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(N,{visible:m.value,"onUpdate:visible":e[4]||(e[4]=a=>m.value=a),title:y.value?"Edit Role":"Create Role",onOk:K,onCancel:L},{default:o(()=>[s(ne,{ref_key:"formRef",ref:C,model:l,rules:O,layout:"vertical"},{default:o(()=>[s(w,{field:"code",label:"Code"},{default:o(()=>[s(F,{modelValue:l.code,"onUpdate:modelValue":e[0]||(e[0]=a=>l.code=a),placeholder:"Enter role code (e.g., admin)"},null,8,["modelValue"])]),_:1}),s(w,{field:"name",label:"Name"},{default:o(()=>[s(F,{modelValue:l.name,"onUpdate:modelValue":e[1]||(e[1]=a=>l.name=a),placeholder:"Enter role name"},null,8,["modelValue"])]),_:1}),s(w,{field:"description",label:"Description"},{default:o(()=>[s(oe,{modelValue:l.description,"onUpdate:modelValue":e[2]||(e[2]=a=>l.description=a),placeholder:"Enter description"},null,8,["modelValue"])]),_:1}),s(w,{field:"status",label:"Status"},{default:o(()=>[s(ae,{modelValue:l.status,"onUpdate:modelValue":e[3]||(e[3]=a=>l.status=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),s(N,{visible:p.value,"onUpdate:visible":e[6]||(e[6]=a=>p.value=a),title:"Assign Permissions",width:"600px",onOk:H,onCancel:e[7]||(e[7]=a=>p.value=!1)},{default:o(()=>[s(le,{"checked-keys":g.value,"onUpdate:checkedKeys":e[5]||(e[5]=a=>g.value=a),data:z.value,checkable:"","default-expand-all":!1},{title:o(({node:a})=>[s(b,null,{default:o(()=>[(f(),P(ue(I(a.type)))),u("span",null,d(a.name),1),a.type?(f(),P(U,{key:0,size:"small"},{default:o(()=>[c(d(a.type),1)]),_:2},1024)):me("",!0)]),_:2},1024)]),_:1},8,["checked-keys","data"])]),_:1},8,["visible"])])}}}),Pe=ye(Ve,[["__scopeId","data-v-990efc1b"]]);export{Pe as default};
