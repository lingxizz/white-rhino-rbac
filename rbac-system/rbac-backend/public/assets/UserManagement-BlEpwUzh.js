import{d as ae,n as te,r as s,o as c,c as A,e as a,w as n,f as i,b as le,F as D,k as N,j as F,t as x,v as ne,A as oe,q as se,g as u,h as ue,x as g,y as de,M as h}from"./index-CGZB2ZEZ.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"user-management"},me={class:"table-container"},ce=ae({__name:"UserManagement",setup(pe){const U=u(!1),O=u([]),z=u([]),C=u({total:0,current:1,pageSize:10}),r=u(!1),p=u(!1),_=u(!1),f=u(""),k=u([]),R=u(),o=ue({username:"",password:"",nickname:"",email:"",phone:"",status:!0}),$={username:[{required:!0,message:"请输入用户名"}],password:[{required:!0,message:"请输入密码"}]},b=async()=>{U.value=!0;try{const l=await g.getUsers();O.value=l,C.value.total=l.length}finally{U.value=!1}},q=async()=>{try{const l=await de.getRoles();z.value=l}catch(l){console.error("Failed to fetch roles:",l)}},E=()=>{_.value=!1,f.value="",o.username="",o.password="",o.nickname="",o.email="",o.phone="",o.status=!0,r.value=!0},I=l=>{_.value=!0,f.value=l.id,o.username=l.username,o.nickname=l.nickname||"",o.email=l.email||"",o.phone=l.phone||"",o.status=l.status,r.value=!0},P=async()=>{var e;if(!await((e=R.value)==null?void 0:e.validate()))try{_.value?(await g.updateUser(f.value,o),h.success("用户更新成功")):(await g.createUser(o),h.success("用户创建成功")),r.value=!1,b()}catch(M){console.error("Failed to save user:",M)}},S=()=>{var l;r.value=!1,(l=R.value)==null||l.resetFields()},j=async l=>{try{await g.deleteUser(l.id),h.success("用户删除成功"),b()}catch(e){console.error("Failed to delete user:",e)}},L=l=>{f.value=l.id,k.value=l.roles.map(e=>e.id),p.value=!0},T=async()=>{try{await g.assignRoles(f.value,k.value),h.success("角色分配成功"),p.value=!1,b()}catch(l){console.error("Failed to assign roles:",l)}},G=l=>{C.value.current=l};return te(()=>{b(),q()}),(l,e)=>{const M=s("icon-plus"),V=s("a-button"),y=s("a-space"),d=s("a-table-column"),H=s("a-tag"),J=s("a-badge"),K=s("a-popconfirm"),Q=s("a-table"),w=s("a-input"),m=s("a-form-item"),W=s("a-input-password"),X=s("a-switch"),Y=s("a-form"),B=s("a-modal"),Z=s("a-checkbox"),ee=s("a-checkbox-group");return c(),A("div",re,[a(y,{class:"header-actions",size:"medium"},{default:n(()=>[a(V,{type:"primary",onClick:E},{icon:n(()=>[a(M)]),default:n(()=>[e[10]||(e[10]=i(" 新增用户 ",-1))]),_:1})]),_:1}),le("div",me,[a(Q,{data:O.value,loading:U.value,pagination:C.value,onPageChange:G},{columns:n(()=>[a(d,{title:"用户名","data-index":"username"}),a(d,{title:"昵称","data-index":"nickname"}),a(d,{title:"邮箱","data-index":"email"}),a(d,{title:"手机号","data-index":"phone"}),a(d,{title:"角色"},{cell:n(({record:t})=>[a(y,{wrap:""},{default:n(()=>[(c(!0),A(D,null,N(t.roles,v=>(c(),F(H,{key:v.id,color:"arcoblue"},{default:n(()=>[i(x(v.name),1)]),_:2},1024))),128))]),_:2},1024)]),_:1}),a(d,{title:"状态"},{cell:n(({record:t})=>[a(J,{status:t.status?"success":"danger",text:t.status?"启用":"禁用"},null,8,["status","text"])]),_:1}),a(d,{title:"创建时间","data-index":"createdAt"},{cell:n(({record:t})=>[i(x(ne(oe)(t.createdAt)),1)]),_:1}),a(d,{title:"操作",width:"200"},{cell:n(({record:t})=>[a(y,null,{default:n(()=>[a(V,{type:"text",size:"small",onClick:v=>I(t)},{default:n(()=>[...e[11]||(e[11]=[i("编辑",-1)])]),_:1},8,["onClick"]),a(V,{type:"text",size:"small",onClick:v=>L(t)},{default:n(()=>[...e[12]||(e[12]=[i("角色",-1)])]),_:1},8,["onClick"]),a(K,{content:"确定要删除这个用户吗？",onOk:v=>j(t)},{default:n(()=>[a(V,{type:"text",status:"danger",size:"small"},{default:n(()=>[...e[13]||(e[13]=[i("删除",-1)])]),_:1})]),_:1},8,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading","pagination"])]),a(B,{visible:r.value,"onUpdate:visible":e[6]||(e[6]=t=>r.value=t),title:_.value?"编辑用户":"新增用户",onOk:P,onCancel:S},{default:n(()=>[a(Y,{ref_key:"formRef",ref:R,model:o,rules:$,layout:"vertical"},{default:n(()=>[a(m,{field:"username",label:"用户名"},{default:n(()=>[a(w,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=t=>o.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),_.value?se("",!0):(c(),F(m,{key:0,field:"password",label:"密码"},{default:n(()=>[a(W,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=t=>o.password=t),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),a(m,{field:"nickname",label:"昵称"},{default:n(()=>[a(w,{modelValue:o.nickname,"onUpdate:modelValue":e[2]||(e[2]=t=>o.nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(m,{field:"email",label:"邮箱"},{default:n(()=>[a(w,{modelValue:o.email,"onUpdate:modelValue":e[3]||(e[3]=t=>o.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(m,{field:"phone",label:"手机号"},{default:n(()=>[a(w,{modelValue:o.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>o.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(m,{field:"status",label:"状态"},{default:n(()=>[a(X,{modelValue:o.status,"onUpdate:modelValue":e[5]||(e[5]=t=>o.status=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(B,{visible:p.value,"onUpdate:visible":e[8]||(e[8]=t=>p.value=t),title:"分配角色",onOk:T,onCancel:e[9]||(e[9]=t=>p.value=!1)},{default:n(()=>[a(ee,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=t=>k.value=t)},{default:n(()=>[a(y,{direction:"vertical"},{default:n(()=>[(c(!0),A(D,null,N(z.value,t=>(c(),F(Z,{key:t.id,value:t.id},{default:n(()=>[i(x(t.name)+" ("+x(t.code)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["visible"])])}}}),ve=ie(ce,[["__scopeId","data-v-8e41687b"]]);export{ve as default};
