import{d as Q,a as W,n as X,r as s,o as C,c as S,e,w as a,b as t,f as _,t as p,v as u,F as Y,k as Z,j as $,A as ee,g as w,h as q,x as D,M}from"./index-CGZB2ZEZ.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"profile-page"},se={class:"profile-header"},le={class:"profile-info"},re=Q({__name:"Profile",setup(ne){const d=W(),x=w(),P=w(),g=w(!1),v=w(!1),r=q({nickname:"",email:"",phone:""}),n=q({oldPassword:"",newPassword:"",confirmPassword:""}),j={email:[{type:"email",message:"Please enter a valid email"}]},z={oldPassword:[{required:!0,message:"Please enter current password"}],newPassword:[{required:!0,message:"Please enter new password"},{minLength:6,message:"Password must be at least 6 characters"}],confirmPassword:[{required:!0,message:"Please confirm new password"},{validator:(i,o)=>{i!==n.newPassword?o("Passwords do not match"):o()}}]},I=()=>{const i=d.user;i&&(r.nickname=i.nickname||"",r.email=i.email||"",r.phone=i.phone||"")},J=async()=>{var o;if(!await((o=x.value)==null?void 0:o.validate())){g.value=!0;try{await D.updateProfile(r),M.success("Profile updated successfully"),await d.fetchProfile()}catch(m){console.error("Failed to update profile:",m)}finally{g.value=!1}}},T=async()=>{var o,m;if(!await((o=P.value)==null?void 0:o.validate())){v.value=!0;try{await D.changePassword({oldPassword:n.oldPassword,newPassword:n.newPassword}),M.success("Password changed successfully"),(m=P.value)==null||m.resetFields()}catch(h){console.error("Failed to change password:",h)}finally{v.value=!1}}};return X(()=>{I()}),(i,o)=>{const m=s("a-avatar"),h=s("a-tag"),G=s("a-space"),H=s("a-divider"),F=s("icon-email"),U=s("icon-phone"),K=s("icon-clock-circle"),k=s("a-card"),f=s("a-col"),O=s("icon-user"),V=s("a-input"),c=s("a-form-item"),E=s("a-row"),N=s("a-button"),R=s("a-form"),y=s("icon-lock"),b=s("a-input-password");return C(),S("div",oe,[e(E,{gutter:24},{default:a(()=>[e(f,{span:8},{default:a(()=>[e(k,{bordered:!1,class:"profile-card"},{default:a(()=>{var l,A,B;return[t("div",se,[e(m,{size:80,style:{backgroundColor:"#165dff"}},{default:a(()=>[_(p(u(d).nickname.charAt(0).toUpperCase()),1)]),_:1}),t("h2",null,p(u(d).nickname),1),t("p",null,p(u(d).username),1),e(G,{wrap:""},{default:a(()=>[(C(!0),S(Y,null,Z(u(d).roles,L=>(C(),$(h,{key:L.id,color:"arcoblue"},{default:a(()=>[_(p(L.name),1)]),_:2},1024))),128))]),_:1})]),e(H),t("div",le,[t("p",null,[e(F),t("span",null,p(((l=u(d).user)==null?void 0:l.email)||"Not set"),1)]),t("p",null,[e(U),t("span",null,p(((A=u(d).user)==null?void 0:A.phone)||"Not set"),1)]),t("p",null,[e(K),t("span",null,"Joined "+p(u(ee)((B=u(d).user)==null?void 0:B.createdAt)),1)])])]}),_:1})]),_:1}),e(f,{span:16},{default:a(()=>[e(k,{title:"Edit Profile",bordered:!1,class:"edit-card"},{default:a(()=>[e(R,{ref_key:"profileFormRef",ref:x,model:r,rules:j,layout:"vertical"},{default:a(()=>[e(E,{gutter:16},{default:a(()=>[e(f,{span:12},{default:a(()=>[e(c,{field:"nickname",label:"Nickname"},{default:a(()=>[e(V,{modelValue:r.nickname,"onUpdate:modelValue":o[0]||(o[0]=l=>r.nickname=l),placeholder:"Enter nickname"},{prefix:a(()=>[e(O)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:a(()=>[e(c,{field:"email",label:"Email"},{default:a(()=>[e(V,{modelValue:r.email,"onUpdate:modelValue":o[1]||(o[1]=l=>r.email=l),placeholder:"Enter email"},{prefix:a(()=>[e(F)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{field:"phone",label:"Phone"},{default:a(()=>[e(V,{modelValue:r.phone,"onUpdate:modelValue":o[2]||(o[2]=l=>r.phone=l),placeholder:"Enter phone"},{prefix:a(()=>[e(U)]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:a(()=>[e(N,{type:"primary",onClick:J,loading:g.value},{default:a(()=>[...o[6]||(o[6]=[_(" Save Changes ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(k,{title:"Change Password",bordered:!1,class:"password-card"},{default:a(()=>[e(R,{ref_key:"passwordFormRef",ref:P,model:n,rules:z,layout:"vertical"},{default:a(()=>[e(c,{field:"oldPassword",label:"Current Password"},{default:a(()=>[e(b,{modelValue:n.oldPassword,"onUpdate:modelValue":o[3]||(o[3]=l=>n.oldPassword=l),placeholder:"Enter current password"},{prefix:a(()=>[e(y)]),_:1},8,["modelValue"])]),_:1}),e(c,{field:"newPassword",label:"New Password"},{default:a(()=>[e(b,{modelValue:n.newPassword,"onUpdate:modelValue":o[4]||(o[4]=l=>n.newPassword=l),placeholder:"Enter new password"},{prefix:a(()=>[e(y)]),_:1},8,["modelValue"])]),_:1}),e(c,{field:"confirmPassword",label:"Confirm Password"},{default:a(()=>[e(b,{modelValue:n.confirmPassword,"onUpdate:modelValue":o[5]||(o[5]=l=>n.confirmPassword=l),placeholder:"Confirm new password"},{prefix:a(()=>[e(y)]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:a(()=>[e(N,{type:"primary",onClick:T,loading:v.value},{default:a(()=>[...o[7]||(o[7]=[_(" Update Password ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}}),ie=ae(re,[["__scopeId","data-v-0e603ba4"]]);export{ie as default};
